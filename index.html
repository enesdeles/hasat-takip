<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hasat Takip</title>
<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:10px}
h1{text-align:center;color:#2e7d32}
button{width:100%;padding:12px;margin-top:8px;font-size:16px;background:#2e7d32;color:#fff;border:none;border-radius:6px;cursor:pointer}
button.gray{background:#607d8b}
button.blue{background:#1976d2}
button.red{background:#c62828}
.section{background:#fff;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ddd}
.hidden{display:none}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:8px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e8f5e9;color:#2e7d32}
select,input{width:95%;padding:6px}
#total{text-align:center;font-size:18px;font-weight:bold;margin-top:10px;padding:10px;background:#fff}
</style>
</head>
<body>

<h1>ğŸŒ± Hasat Takip</h1>

<button class="gray" onclick="togglePersonel()">ğŸ‘¥ Personel YÃ¶netimi</button>
<div id="personelPanel" class="section hidden">
  <input id="newPersonel" placeholder="Ä°sim Soyisim">
  <button onclick="addPersonel()">â• Ekle</button>
  <div id="personelList"></div>
</div>

<button class="blue" onclick="location.href='olu-bitki.html'">ğŸŒ¿ Ã–lÃ¼ Bitki Takibe GeÃ§</button>

<table id="table">
<tr><th>TÃ¼nel</th><th>SÄ±ra</th><th>Personel</th><th>Kutu</th></tr>
</table>

<div id="total">Toplam Kutu: 0</div>

<div class="section">
    <button class="blue" onclick="finishDay()">ğŸ’¾ GÃ¼nÃ¼ Bitir ve ArÅŸivle</button>
    <button class="gray" onclick="downloadReport()">ğŸ“Š Raporu Ä°ndir (Excel)</button>
</div>

<button class="red" onclick="clearPage()">ğŸ—‘ï¸ SayfayÄ± Temizle</button>

<script>
const PERSONEL_KEY="sera_personeller";
const DATA_KEY="hasat_kayitlar";
const HISTORY_KEY="genel_is_gecmisi";

const defaultP=["Akile","Beyhan","Emine tÃ¼rk","Emine yavuz","EmiÅŸ","EsengÃ¼l","Fadime","Fatma Demiral","Fatma karabulut","GÃ¼lbeyaz gÃ¼ler","GÃ¼lbeyaz Ã–ztop","Keziban tasoluk","Keziban yÃ¼ce","Keziban yÃ¼ksek","Meryem","MÃ¼jgan","MÃ¼mine","Neslihan","Ã–zgÃ¼l","Raziye koÃ§ak","Raziye sarÄ±","Safiye aslan","Safiye coÅŸkun","Safiye karaca","SatÄ± karakaya","SatÄ± taskin","Sultan","ÅengÃ¼l","Åerife avcÄ±","Åerife demiral","Ummuhan Ã¶zdemir","YaÅŸar"];

let personeller=JSON.parse(localStorage.getItem(PERSONEL_KEY))||defaultP;
let data=JSON.parse(localStorage.getItem(DATA_KEY))||{};

function sorted(){return [...personeller].sort((a,b)=>a.localeCompare(b,'tr'))}

const table=document.getElementById("table");
for(let t=19;t>=1;t--){
    for(let s=1;s<=6;s++){
        const id=`${t}-${s}`;
        const tr=document.createElement("tr");
        tr.dataset.id=id;
        tr.innerHTML=`<td><b>${t}</b></td><td>${s}</td><td>${pSel(id)}</td><td>${kSel(id)}</td>`;
        table.appendChild(tr);
    }
}

function pSel(id){
    let h=`<select onchange="save('${id}','p',this.value)"><option value="">SeÃ§</option>`;
    sorted().forEach(p=>h+=`<option>${p}</option>`);
    return h+="</select>";
}

function kSel(id){
    let h=`<select onchange="save('${id}','k',this.value)">`;
    for(let i=0;i<=200;i++)h+=`<option>${i}</option>`;
    return h+="</select>";
}

function save(id,t,v){
    data[id]=data[id]||{};
    data[id][t]=v;
    localStorage.setItem(DATA_KEY,JSON.stringify(data));
    calc();
}

function calc(){
    let sum=0;
    Object.values(data).forEach(r=>sum+=Number(r.k||0));
    document.getElementById("total").innerText="Toplam Kutu: "+sum;
}

function finishDay(){
    if(!confirm("Veriler arÅŸive eklenecek. Emin misiniz?")) return;
    let history=JSON.parse(localStorage.getItem(HISTORY_KEY))||[];
    const tarih=new Date().toLocaleDateString('tr-TR');
    Object.keys(data).forEach(id=>{
        if(data[id].p && data[id].k > 0){
            const [tun,sir]=id.split("-");
            history.push({tarih, tur:"Hasat", p:data[id].p, t:tun, s:sir, a:data[id].k});
        }
    });
    localStorage.setItem(HISTORY_KEY,JSON.stringify(history));
    data={}; localStorage.removeItem(DATA_KEY);
    alert("ArÅŸivlendi!"); location.reload();
}

function downloadReport(){
    let history=JSON.parse(localStorage.getItem(HISTORY_KEY))||[];
    if(!history.length){alert("Rapor yok!"); return;}
    let csv="\uFEFFTarih;Ä°ÅŸ TÃ¼rÃ¼;Personel;TÃ¼nel;SÄ±ra;Adet\n";
    history.forEach(r=>csv+=`${r.tarih};${r.tur};${r.p};${r.t};${r.s};${r.a}\n`);
    const blob=new Blob([csv],{type:'text/csv'});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="rapor.csv"; a.click();
}

function togglePersonel(){document.getElementById("personelPanel").classList.toggle("hidden"); renderPersonel();}
function renderPersonel(){
    const d=document.getElementById("personelList"); d.innerHTML="";
    sorted().forEach((p,i)=>d.innerHTML+=`<div>${p} <button onclick="removeP('${p}')" style="width:auto;background:red;padding:2px 5px">X</button></div>`);
}
function addPersonel(){
    const val=document.getElementById("newPersonel").value;
    if(!val)return; personeller.push(val);
    localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller));
    location.reload();
}
function removeP(p){
    personeller=personeller.filter(x=>x!==p);
    localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller));
    location.reload();
}

function restore(){
    Object.keys(data).forEach(id=>{
        const r=document.querySelector(`tr[data-id="${id}"]`);
        if(r){const s=r.querySelectorAll("select"); s[0].value=data[id].p||""; s[1].value=data[id].k||"0";}
    });
    calc();
}
restore();
</script>
</body>
</html>
