<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hasat Takip</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2e7d32">

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:10px}
h1{text-align:center;color:#2e7d32}
button{width:100%;padding:12px;margin-top:8px;font-size:16px;background:#2e7d32;color:#fff;border:none;border-radius:6px}
button.small{padding:6px;font-size:14px}
button.gray{background:#607d8b}
button.red{background:#c62828}
.section{background:#fff;padding:10px;margin-bottom:10px;border-radius:6px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e8f5e9}
select,input{width:95%;padding:6px}
#total{text-align:center;font-size:18px;font-weight:bold;margin-top:10px}
.personel-item{display:flex;justify-content:space-between;align-items:center;margin-top:4px}
</style>
</head>

<body>

<h1>ğŸŒ± Hasat Takip</h1>

<!-- PERSONEL ZORUNLU -->
<div class="section" id="personelSection">
  <h3>ğŸ‘©â€ğŸŒ¾ Personel Ekle</h3>
  <input id="personelInput" placeholder="Ä°sim Soyisim">
  <button onclick="addPersonel()">â• Personel Ekle</button>
  <div id="personelList"></div>
</div>

<button class="gray hidden" id="togglePersonelBtn" onclick="togglePersonel()">ğŸ‘©â€ğŸŒ¾ Personel YÃ¶netimi</button>
<button class="gray hidden" onclick="location.href='olu-bitki-takip.html'">ğŸŒ¿ Ã–lÃ¼ Bitki Takibe GeÃ§</button>
<button class="gray hidden" onclick="toggleReports()">ğŸ“ Kaydedilen Raporlar</button>

<div class="section hidden" id="reportsSection"></div>

<table id="table" class="hidden">
<tr><th>TÃ¼nel</th><th>SÄ±ra</th><th>Personel</th><th>Kutu</th></tr>
</table>

<div id="total" class="hidden">Toplam Kutu: 0</div>

<button class="hidden" id="saveBtn" onclick="finishHarvest()">âœ… HasadÄ± Bitir & Kaydet</button>
<button class="hidden" onclick="window.print()">PDF Ä°ndir</button>
<button class="red hidden" onclick="clearPage()">ğŸ—‘ï¸ SayfayÄ± Temizle</button>

<script>
const PERSONEL_KEY="sera_personeller"
const DATA_KEY="hasat_kayitlar"
const REPORT_KEY="hasat_raporlari"

let personeller=JSON.parse(localStorage.getItem(PERSONEL_KEY))||[]
let kayitlar=JSON.parse(localStorage.getItem(DATA_KEY))||{}
let raporlar=JSON.parse(localStorage.getItem(REPORT_KEY))||[]

function init(){
if(personeller.length>0){
document.getElementById("personelSection").classList.add("hidden")
enableApp()
}
renderPersonel()
}
init()

function enableApp(){
document.querySelectorAll(".hidden").forEach(e=>{
if(e.id!=="reportsSection")e.classList.remove("hidden")
})
renderTable()
}

function togglePersonel(){
document.getElementById("personelSection").classList.toggle("hidden")
renderPersonel()
}

/* PERSONEL */
function addPersonel(){
const v=document.getElementById("personelInput").value.trim()
if(!v)return
if(personeller.includes(v))return
personeller.push(v)
personeller.sort((a,b)=>a.localeCompare(b,"tr"))
localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller))
document.getElementById("personelInput").value=""
renderPersonel()
enableApp()
}

function deletePersonel(i){
personeller.splice(i,1)
localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller))
renderPersonel()
renderTable()
}

function renderPersonel(){
const d=document.getElementById("personelList")
d.innerHTML=""
personeller.forEach((p,i)=>{
d.innerHTML+=`
<div class="personel-item">
<span>${p}</span>
<button class="small red" onclick="deletePersonel(${i})">Sil</button>
</div>`
})
}

/* TABLO */
function saveValue(id,t,v){
kayitlar[id]=kayitlar[id]||{}
kayitlar[id][t]=v
localStorage.setItem(DATA_KEY,JSON.stringify(kayitlar))
calc()
}

function restore(id,t){return kayitlar[id]?.[t]||""}

function personelSelect(id){
let h=`<select onchange="saveValue('${id}','p',this.value)">`
h+=`<option value="">SeÃ§</option>`
personeller.forEach(p=>h+=`<option>${p}</option>`)
return h+="</select>"
}

function kutuSelect(id){
let h=`<select onchange="saveValue('${id}','k',this.value)">`
for(let i=0;i<=200;i++)h+=`<option>${i}</option>`
return h+="</select>"
}

function renderTable(){
const table=document.getElementById("table")
table.innerHTML=`<tr><th>TÃ¼nel</th><th>SÄ±ra</th><th>Personel</th><th>Kutu</th></tr>`
for(let t=19;t>=1;t--){
for(let s=1;s<=6;s++){
const id=`${t}-${s}`
const tr=document.createElement("tr")
tr.innerHTML=`<td>${t}</td><td>${s}</td>
<td>${personelSelect(id)}</td>
<td>${kutuSelect(id)}</td>`
table.appendChild(tr)
tr.children[2].querySelector("select").value=restore(id,"p")
tr.children[3].querySelector("select").value=restore(id,"k")
}}
calc()
}

function calc(){
let t=0
document.querySelectorAll("td:nth-child(4) select").forEach(s=>t+=Number(s.value))
document.getElementById("total").innerText="Toplam Kutu: "+t
}

/* RAPOR */
function today(){return new Date().toLocaleDateString("tr-TR")}
function finishHarvest(){
if(!confirm("Hasat raporu kaydedilsin mi?"))return
raporlar.unshift({tarih:today(),toplam:document.getElementById("total").innerText})
localStorage.setItem(REPORT_KEY,JSON.stringify(raporlar))
alert("Hasat raporu kaydedildi âœ”ï¸")
}
function toggleReports(){
const s=document.getElementById("reportsSection")
s.classList.toggle("hidden")
}
function clearPage(){
if(!confirm("Sayfa temizlensin mi?"))return
kayitlar={}
localStorage.removeItem(DATA_KEY)
renderTable()
}
</script>
</body>
</html>
