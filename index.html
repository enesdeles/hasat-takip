<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hasat Takip</title>
<link rel="manifest" href="/hasat-takip/manifest.json">
<meta name="theme-color" content="#2e7d32">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:10px}
h1{text-align:center;color:#2e7d32}
button{width:100%;padding:12px;margin-top:8px;font-size:16px;background:#2e7d32;color:#fff;border:none;border-radius:6px}
button.gray{background:#607d8b}
button.red{background:#c62828}
.section{background:#fff;padding:10px;margin-top:8px;border-radius:6px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:8px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e8f5e9}
select,input{width:95%;padding:6px}
.personel-item{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #ddd}
#total{text-align:center;font-size:18px;font-weight:bold;margin-top:10px}
</style>
</head>

<body>

<h1>ğŸŒ± Hasat Takip</h1>

<button class="gray" onclick="togglePersonel()">ğŸ‘¥ Personel YÃ¶netimi</button>
<div id="personelPanel" class="section hidden">
  <input id="newPersonel" placeholder="Ä°sim Soyisim gir">
  <button onclick="addPersonel()">â• Personel Ekle</button>
  <div id="personelList"></div>
</div>

<button onclick="location.href='olu-bitki.html'">ğŸŒ¿ Ã–lÃ¼ Bitki Takibe GeÃ§</button>

<table id="table">
<tr><th>TÃ¼nel</th><th>SÄ±ra</th><th>Personel</th><th>Kutu</th></tr>
</table>

<div id="total">Toplam Kutu: 0</div>

<button onclick="window.print()">ğŸ“„ PDF Ä°ndir</button>
<button class="red" onclick="clearPage()">ğŸ—‘ï¸ SayfayÄ± Temizle</button>

<script>
const PERSONEL_KEY="sera_personeller"
const DATA_KEY="hasat_kayitlar"

const defaultPersoneller=[
"Akile","Beyhan","Emine tÃ¼rk","Emine yavuz","EmiÅŸ","EsengÃ¼l","Fadime",
"Fatma Demiral","Fatma karabulut","GÃ¼lbeyaz gÃ¼ler","GÃ¼lbeyaz Ã–ztop",
"Keziban tasoluk","Keziban yÃ¼ce","Keziban yÃ¼ksek","Meryem","MÃ¼jgan",
"MÃ¼mine","Neslihan","Ã–zgÃ¼l","Raziye koÃ§ak","Raziye sarÄ±",
"Safiye aslan","Safiye coÅŸkun","Safiye karaca","SatÄ± karakaya",
"SatÄ± taskin","Sultan","ÅengÃ¼l","Åerife avcÄ±","Åerife demiral",
"Ummuhan Ã¶zdemir","YaÅŸar"
]

let personeller=JSON.parse(localStorage.getItem(PERSONEL_KEY))||defaultPersoneller
localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller))

let data=JSON.parse(localStorage.getItem(DATA_KEY))||{}

function sorted(){return [...personeller].sort((a,b)=>a.localeCompare(b,'tr'))}

const table=document.getElementById("table")

for(let t=19;t>=1;t--){
for(let s=1;s<=6;s++){
const id=`${t}-${s}`
const tr=document.createElement("tr")
tr.dataset.id=id
tr.innerHTML=`
<td>${t}</td>
<td>${s}</td>
<td>${personelSelect(id)}</td>
<td>${kutuSelect(id)}</td>`
table.appendChild(tr)
}
}

function personelSelect(id){
let h=`<select onchange="save('${id}','p',this.value)"><option>SeÃ§</option>`
sorted().forEach(p=>h+=`<option>${p}</option>`)
return h+="</select>"
}

function kutuSelect(id){
let h=`<select onchange="save('${id}','k',this.value)">`
for(let i=0;i<=200;i++)h+=`<option>${i}</option>`
return h+="</select>"
}

function save(id,t,v){
data[id]=data[id]||{}
data[id][t]=v
localStorage.setItem(DATA_KEY,JSON.stringify(data))
calc()
}

function restore(){
Object.keys(data).forEach(id=>{
const r=document.querySelector(`tr[data-id="${id}"]`)
if(!r)return
const s=r.querySelectorAll("select")
if(data[id].p)s[0].value=data[id].p
if(data[id].k)s[1].value=data[id].k
})
calc()
}

function calc(){
let sum=0
Object.values(data).forEach(r=>sum+=Number(r.k||0))
document.getElementById("total").innerText="Toplam Kutu: "+sum
}

function clearPage(){
if(!confirm("Sayfa temizlensin mi?"))return
data={}
localStorage.removeItem(DATA_KEY)
document.querySelectorAll("select").forEach(s=>s.value="")
calc()
}

function togglePersonel(){
document.getElementById("personelPanel").classList.toggle("hidden")
renderPersonel()
}

function renderPersonel(){
const d=document.getElementById("personelList")
d.innerHTML=""
sorted().forEach((p,i)=>{
d.innerHTML+=`<div class="personel-item">${p}<button onclick="removePersonel(${i})">âŒ</button></div>`
})
}

function addPersonel(){
const i=document.getElementById("newPersonel")
if(!i.value.trim())return
personeller.push(i.value.trim())
localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller))
i.value=""
updateSelects()
renderPersonel()
}

function removePersonel(i){
personeller=sorted().filter((_,x)=>x!==i)
localStorage.setItem(PERSONEL_KEY,JSON.stringify(personeller))
updateSelects()
renderPersonel()
}

function updateSelects(){
document.querySelectorAll("td select:first-child").forEach(s=>{
const v=s.value
s.innerHTML="<option>SeÃ§</option>"
sorted().forEach(p=>s.innerHTML+=`<option>${p}</option>`)
s.value=v
})
}

restore()
</script>

</body>
</html>
